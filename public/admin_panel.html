<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Administratora</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .container {
            max-width: 800px;
            margin-top: 50px;
        }
        .product-form {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .delete-btn, .edit-btn {
            float: right;
            cursor: pointer;
            margin-left: 10px;
        }
        .delete-btn {
            color: red;
        }
        .edit-btn {
            color: #0d6efd;
        }
    </style>
</head>
<body>
    <!-- Modal do wprowadzania hasła -->
    <div class="modal fade" id="adminPasswordModal" tabindex="-1" aria-labelledby="adminPasswordModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="adminPasswordModalLabel">Autoryzacja administratora</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="adminPassword" class="form-label">Podaj hasło administratora:</label>
                        <input type="password" class="form-control" id="adminPassword" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Anuluj</button>
                    <button type="button" class="btn btn-primary" id="confirmPassword">Potwierdź</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal do edycji produktu -->
    <div class="modal fade" id="editProductModal" tabindex="-1" aria-labelledby="editProductModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editProductModalLabel">Edycja produktu</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editProductForm">
                        <input type="hidden" id="editProductId">
                        <div class="mb-3">
                            <label class="form-label">Typ produktu:</label>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="editProductType" id="editSteamAccount" value="steam" required>
                                <label class="form-check-label" for="editSteamAccount">Konto Steam</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="editProductType" id="editInstagramAccount" value="instagram">
                                <label class="form-check-label" for="editInstagramAccount">Konto Instagram</label>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="editProductName" class="form-label">Nazwa produktu</label>
                            <input type="text" class="form-control" id="editProductName" required>
                        </div>
                        <div class="mb-3">
                            <label for="editProductDescription" class="form-label">Opis produktu</label>
                            <textarea class="form-control" id="editProductDescription" rows="3" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="editProductPrice" class="form-label">Cena (PLN)</label>
                            <input type="number" class="form-control" id="editProductPrice" required>
                        </div>
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="editProductPromotion" onchange="toggleEditPromotionFields()">
                                <label class="form-check-label" for="editProductPromotion">
                                    Włącz promocję
                                </label>
                            </div>
                        </div>
                        <div id="editPromotionFields" style="display: none;">
                            <div class="mb-3">
                                <label for="editPromotionPrice" class="form-label">Cena promocyjna (PLN)</label>
                                <input type="number" class="form-control" id="editPromotionPrice">
                            </div>
                            <div class="mb-3">
                                <label for="editPromotionEndDate" class="form-label">Data zakończenia promocji</label>
                                <input type="datetime-local" class="form-control" id="editPromotionEndDate">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Anuluj</button>
                    <button type="button" class="btn btn-primary" id="saveEditButton">Zapisz zmiany</button>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <h1 class="mb-4">Panel Administratora</h1>
        <div class="product-form">
            <form id="productForm">
                <div class="mb-3">
                    <label class="form-label">Typ produktu</label>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="productType" id="steam" value="steam" checked>
                        <label class="form-check-label" for="steam">
                            Konto Steam
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="productType" id="instagram" value="instagram">
                        <label class="form-check-label" for="instagram">
                            Konto Instagram
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="productType" id="facebook" value="facebook">
                        <label class="form-check-label" for="facebook">
                            Konto Facebook
                        </label>
                    </div>
                </div>
                
                <div class="mb-3">
                    <label for="productName" class="form-label">Nazwa produktu</label>
                    <input type="text" class="form-control" id="productName" required>
                </div>

                <div class="mb-3">
                    <label for="productDescription" class="form-label">Opis produktu</label>
                    <small class="form-text text-muted d-block">Każdą linię opisu zacznij od "✦ ". Przykład:<br>✦ Długa historia<br>✦ Pełna weryfikacja<br>✦ Gwarancja bezpieczeństwa</small>
                    <textarea class="form-control mt-2" id="productDescription" rows="3" required></textarea>
                </div>

                <div class="mb-3">
                    <label for="productPrice" class="form-label">Cena (PLN)</label>
                    <input type="number" class="form-control" id="productPrice" required>
                </div>

                <div class="mb-3">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="productPromotion" onchange="togglePromotionFields()">
                        <label class="form-check-label" for="productPromotion">
                            Włącz promocję
                        </label>
                    </div>
                </div>

                <div id="promotionFields" style="display: none;">
                    <div class="mb-3">
                        <label for="promotionPrice" class="form-label">Cena promocyjna (PLN)</label>
                        <input type="number" class="form-control" id="promotionPrice">
                    </div>
                    <div class="mb-3">
                        <label for="promotionEndDate" class="form-label">Data zakończenia promocji</label>
                        <input type="datetime-local" class="form-control" id="promotionEndDate">
                    </div>
                </div>

                <button type="submit" class="btn btn-primary">Dodaj produkt</button>
            </form>
        </div>

        <div class="mt-4">
            <h2>Lista produktów</h2>
            <div id="productList" class="list-group mt-3">
                <!-- Tu będą wyświetlane dodane produkty -->
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Domyślne produkty
        const defaultProducts = [
            {
                id: 1,
                type: 'steam',
                name: 'Konto Steam 2009',
                description: 'Stare konto Steam z 2009 roku',
                price: 120
            },
            {
                id: 2,
                type: 'steam',
                name: 'Konto Steam 2019',
                description: 'Konto Steam z 2019 roku',
                price: 50
            },
            {
                id: 3,
                type: 'steam',
                name: 'Konto Steam 2023 prime cs2',
                description: 'Nowe konto Steam z CS2 Prime',
                price: 90
            },
            {
                id: 4,
                type: 'instagram',
                name: 'Konto Instagram 50k Follow',
                description: 'Konto Instagram z 50 tysiącami followersów',
                price: 40
            },
            {
                id: 5,
                type: 'instagram',
                name: 'Konto Instagram 195K Follow',
                description: 'Konto Instagram z 195 tysiącami followersów',
                price: 180
            },
            {
                id: 6,
                type: 'facebook',
                name: 'Konto Facebook 2012',
                description: 'Stare konto Facebook z 2012 roku',
                price: 45
            },
            {
                id: 7,
                type: 'facebook',
                name: 'Konto Facebook 2015',
                description: 'Konto Facebook z 2015 roku',
                price: 35
            },
            {
                id: 8,
                type: 'facebook',
                name: 'Konto Facebook 2018',
                description: 'Konto Facebook z 2018 roku',
                price: 25
            }
        ];

        // Inicjalizacja localStorage przy pierwszym uruchomieniu
        if (!localStorage.getItem('products')) {
            localStorage.setItem('products', JSON.stringify(defaultProducts));
        }

        // Wczytaj produkty z localStorage
        let products = JSON.parse(localStorage.getItem('products'));

        let productDataToAdd = null;
        const adminModal = new bootstrap.Modal(document.getElementById('adminPasswordModal'));

        function togglePromotionFields() {
            const promotionFields = document.getElementById('promotionFields');
            const isPromotionEnabled = document.getElementById('productPromotion').checked;
            promotionFields.style.display = isPromotionEnabled ? 'block' : 'none';
        }

        function toggleEditPromotionFields() {
            const promotionFields = document.getElementById('editPromotionFields');
            const isPromotionEnabled = document.getElementById('editProductPromotion').checked;
            promotionFields.style.display = isPromotionEnabled ? 'block' : 'none';
        }

        document.getElementById('productForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const productType = document.querySelector('input[name="productType"]:checked').value;
            const productName = document.getElementById('productName').value;
            const productDescription = document.getElementById('productDescription').value;
            const productPrice = document.getElementById('productPrice').value;
            const isPromotionEnabled = document.getElementById('productPromotion').checked;

            productDataToAdd = {
                id: Date.now(),
                type: productType,
                name: productName,
                description: productDescription,
                price: parseFloat(productPrice),
                promotion: isPromotionEnabled ? {
                    enabled: true,
                    price: parseFloat(document.getElementById('promotionPrice').value),
                    endDate: document.getElementById('promotionEndDate').value
                } : null
            };

            adminModal.show();
        });

        document.getElementById('confirmPassword').addEventListener('click', () => {
            const password = document.getElementById('adminPassword').value;
            
            if (password === 'kutaz123') {
                // Dodaj produkt do tablicy
                products.push(productDataToAdd);
                
                // Zapisz do localStorage
                localStorage.setItem('products', JSON.stringify(products));
                
                // Wyczyść formularz i zamknij modal
                document.getElementById('productForm').reset();
                document.getElementById('adminPassword').value = '';
                adminModal.hide();
                
                // Odśwież listę produktów
                displayProducts();
                
                alert('Produkt został dodany pomyślnie!');
            } else {
                alert('Nieprawidłowe hasło administratora!');
            }
        });

        const editProductModal = new bootstrap.Modal(document.getElementById('editProductModal'));
        let editingProductId = null;

        // Funkcja do edycji produktu
        function editProduct(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;

            editingProductId = productId;
            
            document.getElementById('editProductId').value = product.id;
            document.querySelector(`input[name="editProductType"][value="${product.type}"]`).checked = true;
            document.getElementById('editProductName').value = product.name;
            document.getElementById('editProductDescription').value = product.description;
            document.getElementById('editProductPrice').value = product.price;
            
            // Ustawienie pól promocji
            const hasPromotion = product.promotion && product.promotion.enabled;
            document.getElementById('editProductPromotion').checked = hasPromotion;
            if (hasPromotion) {
                document.getElementById('editPromotionPrice').value = product.promotion.price;
                document.getElementById('editPromotionEndDate').value = product.promotion.endDate;
                document.getElementById('editPromotionFields').style.display = 'block';
            } else {
                document.getElementById('editPromotionFields').style.display = 'none';
            }

            editProductModal.show();
        }

        // Obsługa zapisywania zmian
        document.getElementById('saveEditButton').addEventListener('click', () => {
            const productIndex = products.findIndex(p => p.id === editingProductId);
            if (productIndex === -1) return;

            const isPromotionEnabled = document.getElementById('editProductPromotion').checked;
            const updatedProduct = {
                id: editingProductId,
                type: document.querySelector('input[name="editProductType"]:checked').value,
                name: document.getElementById('editProductName').value,
                description: document.getElementById('editProductDescription').value,
                price: parseFloat(document.getElementById('editProductPrice').value),
                promotion: isPromotionEnabled ? {
                    enabled: true,
                    price: parseFloat(document.getElementById('editPromotionPrice').value),
                    endDate: document.getElementById('editPromotionEndDate').value
                } : null
            };

            products[productIndex] = updatedProduct;
            localStorage.setItem('products', JSON.stringify(products));
            editProductModal.hide();
            displayProducts();
            alert('Produkt został zaktualizowany!');
        });

        // Funkcja do sprawdzania i aktualizowania statusu promocji
        function checkAndUpdatePromotions() {
            const currentDate = new Date();
            let hasChanges = false;

            products = products.map(product => {
                if (product.promotion && product.promotion.enabled) {
                    const endDate = new Date(product.promotion.endDate);
                    if (endDate <= currentDate) {
                        // Promocja wygasła
                        product.promotion = null;
                        hasChanges = true;
                    }
                }
                return product;
            });

            if (hasChanges) {
                localStorage.setItem('products', JSON.stringify(products));
            }
        }

        function displayProducts() {
            const productList = document.getElementById('productList');
            productList.innerHTML = '';
            
            // Sprawdź i zaktualizuj status promocji przed wyświetleniem
            checkAndUpdatePromotions();
            
            const steamProducts = products.filter(p => p.type === 'steam');
            const instagramProducts = products.filter(p => p.type === 'instagram');
            const facebookProducts = products.filter(p => p.type === 'facebook');
            
            if (steamProducts.length > 0) {
                productList.innerHTML += '<h3 class="mt-3">Konta Steam</h3>';
                steamProducts.forEach(addProductToList);
            }
            
            if (instagramProducts.length > 0) {
                productList.innerHTML += '<h3 class="mt-3">Konta Instagram</h3>';
                instagramProducts.forEach(addProductToList);
            }

            if (facebookProducts.length > 0) {
                productList.innerHTML += '<h3 class="mt-3">Konta Facebook</h3>';
                facebookProducts.forEach(addProductToList);
            }
        }

        function addProductToList(product) {
            const productList = document.getElementById('productList');
            const productElement = document.createElement('div');
            productElement.className = 'list-group-item';
            
            let priceDisplay = `${product.price} PLN`;
            if (product.promotion && product.promotion.enabled) {
                const endDate = new Date(product.promotion.endDate);
                if (endDate > new Date()) {
                    priceDisplay = `
                        <span style="text-decoration: line-through;">${product.price} PLN</span>
                        <span style="color: red; margin-left: 10px;">${product.promotion.price} PLN</span>
                        <br>
                        <small style="color: #666;">Promocja do: ${endDate.toLocaleString()}</small>
                    `;
                }
            }

            productElement.innerHTML = `
                <h5>${product.name} 
                    <span class="delete-btn" onclick="deleteProduct(${product.id})">❌</span>
                    <span class="edit-btn" onclick="editProduct(${product.id})">✏️</span>
                </h5>
                <p><strong>Typ:</strong> ${product.type === 'steam' ? 'Steam' : product.type === 'instagram' ? 'Instagram' : 'Facebook'}</p>
                <p><strong>Opis:</strong> ${product.description}</p>
                <p><strong>Cena:</strong> ${priceDisplay}</p>
            `;
            productList.appendChild(productElement);
        }

        function deleteProduct(productId) {
            if (confirm('Czy na pewno chcesz usunąć ten produkt?')) {
                products = products.filter(p => p.id !== productId);
                // Zapisz zaktualizowaną listę do localStorage
                localStorage.setItem('products', JSON.stringify(products));
                displayProducts();
            }
        }

        // Wyświetl produkty przy starcie
        displayProducts();
    </script>
</body>
</html> 